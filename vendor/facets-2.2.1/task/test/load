#!/usr/bin/env ratch

# simple load test

main :syntax do
  scripts = "lib/**/*.rb"
  libpath = [ 'lib/methods', 'lib/core', 'lib/more' ].join(':')

  checklist = []
  cnt = 0
  scripts = multiglob(*scripts) #- multiglob_r(ignore)
  scripts.each do |s|
    next unless File.file?(s)
    #if not system "ruby -c -Ibin:lib:test #{s} &> /dev/null" then
    if system("ruby -I#{libpath} #{s} > /dev/null")
      puts "#{s} [PASS]" #if verbose?
    else
      puts "Load Issue: #{s}"
      checklist << :load
      cnt += 1
    end
  end

  if cnt == 0
    puts "Load dependencies check out."
  else
    puts "#{cnt} Load Failures:\n  "
    puts checklist.join("\n  ")
  end
end
